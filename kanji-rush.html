<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kanji Rush - Êó•Êú¨Ë™û Meme Edition</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        body {
            font-family: 'Press Start 2P', cursive;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            /* Nouveau fond align√© √† droite */
            background: url('https://i.etsystatic.com/27904950/r/il/7963c5/3055276989/il_1080xN.3055276989_mzu3.jpg') no-repeat right center/cover;
            overflow: hidden;
            color: #fff;
            text-shadow: 2px 2px 4px #000;
        }
        #game-container {
            text-align: center;
            padding: 40px;
            background: rgba(255, 105, 180, 0.9);
            border-radius: 20px;
            box-shadow: 0 0 20px rgba(255, 0, 255, 0.7);
            width: 90%;
            max-width: 700px;
            border: 5px solid #00ffff;
            position: relative;
        }
        #record-overlay {
            position: absolute;
            bottom: -50px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 36px;
            color: #ff00ff;
            text-shadow: 3px 3px 6px #00ffff;
            animation: blink 0.5s infinite;
            z-index: 1000;
        }
        #start-screen, #game-screen, #game-over-screen {
            transition: opacity 0.5s;
        }
        .hidden {
            opacity: 0;
            display: none;
        }
        h1 {
            font-size: 36px;
            color: #ffff00;
            text-shadow: 3px 3px 6px #ff00ff;
        }
        label {
            font-size: 20px;
            margin: 10px 0;
            display: block;
        }
        input[type="checkbox"] {
            transform: scale(1.5);
            margin-right: 10px;
        }
        #kana-display {
            font-size: 120px;
            margin: 20px 0;
            color: #00ff00;
        }
        #lives {
            font-size: 40px;
            margin: 15px 0;
        }
        #timer {
            font-size: 24px;
            color: #ff0000;
            text-shadow: 2px 2px 4px #00ffff;
            margin: 10px 0;
            display: none; /* Cach√© par d√©faut, affich√© en mode Hardcore */
        }
        .button-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 30px 0;
        }
        button {
            padding: 25px;
            font-size: 24px;
            font-family: 'Press Start 2P', cursive;
            cursor: pointer;
            background: #ff00ff;
            color: #fff;
            border: 3px solid #00ff00;
            border-radius: 10px;
            transition: transform 0.2s, background 0.2s;
        }
        button:hover {
            transform: scale(1.1);
            background: #00ffff;
            color: #000;
        }
        @keyframes blink {
            50% { opacity: 0; }
        }
        #high-scores {
            margin-top: 20px;
            font-size: 18px;
            color: #00ff00;
        }
        small {
            font-size: 12px;
            color: #fff;
            text-shadow: none;
            display: block;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
</head>
<body>
    <div id="game-container">
        <!-- √âcran de d√©marrage -->
        <div id="start-screen">
            <h1>Kanji Rush</h1>
            <label><input type="checkbox" id="hiragana-check" checked> Hiragana („Å≤„Çâ„Åå„Å™)</label>
            <label><input type="checkbox" id="katakana-check"> Katakana („Ç´„Çø„Ç´„Éä)</label>
            <label><input type="checkbox" id="kanji-n5-check"> Kanji N5 (Êº¢Â≠ó N5)</label>
            <label><input type="checkbox" id="kanji-n4-check"> Kanji N4 (Êº¢Â≠ó N4)</label>
            <label><input type="checkbox" id="hardcore-check"> Mode Hardcore üíÄ</label>
            <button id="start-btn">START DESU</button>
        </div>
        <!-- √âcran de jeu -->
        <div id="game-screen" class="hidden">
            <div>„Çπ„Ç≥„Ç¢: <span id="score">0</span></div>
            <div>„É¨„Ç≥„Éº„Éâ: <span id="high-score">0</span> (<span id="record-date">-</span>)</div>
            <div id="lives"></div>
            <div id="timer">TIME LEFT: 5s</div>
            <div id="kana-display"></div>
            <div class="button-grid" id="choices"></div>
        </div>
        <!-- √âcran de fin -->
        <div id="game-over-screen" class="hidden">
            <h2>GAME OVER DA YO</h2>
            <div id="high-scores"></div>
            <button id="play-again">INSERT COIN üí∞</button>
        </div>
        <div id="record-overlay" class="hidden">NEW RECORD! üéâ</div>
    </div>

    <script>
        // Donn√©es des kana et kanji
        const hiraganaList = ['„ÅÇ', '„ÅÑ', '„ÅÜ', '„Åà', '„Åä','„Åã', '„Åç', '„Åè', '„Åë', '„Åì','„Åå', '„Åé', '„Åê', '„Åí', '„Åî','„Å±', '„Å¥', '„Å∑', '„Å∫', '„ÅΩ'];
        const katakanaList = ['„Ç¢', '„Ç§', '„Ç¶', '„Ç®', '„Ç™','„Ç´', '„Ç≠', '„ÇØ', '„Ç±', '„Ç≥','„Ç¨', '„ÇÆ', '„Ç∞', '„Ç≤', '„Ç¥','„Éë', '„Éî', '„Éó', '„Éö', '„Éù'];
        const kanjiN5List = ['‰∏Ä', '‰∏É', '‰∏á', '‰∏â', '‰∏ä', '‰∏ã', '‰∏≠', '‰πù', '‰∫å', '‰∫î', '‰∫∫', '‰ªä', '‰ºë', '‰Ωï', 'ÂÖà', 'ÂÖ•', 'ÂÖ´', 'ÂÖ≠', 'ÂÜÜ', 'Âá∫', 'ÂàÜ', 'Ââç', 'Âåó', 'ÂçÅ', 'ÂçÉ', 'Âçà', 'Âçä', 'Âçó', 'Âèã', 'Âè≥', 'Âêç', 'Âõõ', 'ÂõΩ', 'Âúü', 'Â§ñ', 'Â§ß', 'Â§©', 'Â•≥', 'Â≠ê', 'Â≠¶', 'Â∞è', 'Â±±', 'Â∑ù', 'Â∑¶', 'Âπ¥', 'Âæå', 'Êó•', 'ÊôÇ', 'Êõ∏', 'Êúà', 'Êú®', 'Êú¨', 'Êù•', 'Êù±', 'Ê†°', 'ÊØç', 'ÊØé', 'Ê∞ó', 'Ê∞¥', 'ÁÅ´', 'Áà∂', 'Áîü', 'Áî∑', 'ÁôΩ', 'Áôæ', 'ËÅû', 'Ë°å', 'Ë•ø', 'Ë¶ã', 'Ë©±', 'Ë™û', 'Ë™≠', 'Ëªä', 'Èáë', 'Èï∑', 'Èñì', 'Èõ®', 'Èõª', 'È£ü', 'È´ò'];
        const kanjiN4List = ['‰∏ç', '‰∏ñ', '‰∏ª', '‰∫ã', '‰∫¨', '‰ª£', '‰ª•', '‰ºö', '‰Ωè', '‰Ωì', '‰Ωú', '‰Ωø', 'ÂÖÉ', 'ÂÖ¨', 'Âàá', 'Âà•', 'Âäõ', 'Âãï', 'Âè£', 'Âè∞', 'Âêå', 'ÂìÅ', 'Âì°', 'Âïè', 'Âú∞', 'Â†¥', 'Â£≤', 'Â§ö', 'Âßã', 'ÂÆâ', 'ÂÆ∂', 'Â∞ë', 'Â∑•', 'Â∫É', 'Â∫ó', 'Â∫¶', 'Âª∫', 'Âº∑', 'ÂøÉ', 'ÊÄù', 'ÊÄ•', 'ÊÑè', 'Êâã', 'ÊåÅ', 'Êïô', 'Êñá', 'Êñô', 'Êñ∞', 'Êñπ', 'Êòé', 'Êúâ', 'Êúù', 'Ê•≠', 'Ê•Ω', 'Ê≠¢', 'Ê≠£', 'Ê≠ª', 'Êµ∑', 'ÁÑ°', 'Áâ©', 'Áâπ', 'ÁêÜ', 'Áî®', 'Áî∞', 'Áî∫', 'Áîª', 'Áïå', 'ÁóÖ', 'Áô∫', 'ÁõÆ', 'Áúü', 'ÁùÄ', 'Áü•', 'Á†î', 'Á§æ', 'ÁßÅ', 'Á©∂', 'Á©∫', 'Á´ã', 'ÁµÇ', 'ËÄÉ', 'ËÄÖ', 'Ëá™', 'Ë®Ä', 'Ë®à', 'Ë≥™', 'Ëµ∑', 'Ë∂≥', 'Ëª¢', 'Ëøë', 'ÈÄÅ', 'ÈÄö', 'ÈÅã', 'ÈÅì', 'Èáç', 'Èáé', 'Èñã', 'Èô¢', 'ÈõÜ', 'È°å'];

        const kanaToRomaji = {            
            // Hiragana de base
            '„ÅÇ': 'a', '„ÅÑ': 'i', '„ÅÜ': 'u', '„Åà': 'e', '„Åä': 'o',
            '„Åã': 'ka', '„Åç': 'ki', '„Åè': 'ku', '„Åë': 'ke', '„Åì': 'ko',
            // Dakuten
            '„Åå': 'ga', '„Åé': 'gi', '„Åê': 'gu', '„Åí': 'ge', '„Åî': 'go',
            // Handakuten
            '„Å±': 'pa', '„Å¥': 'pi', '„Å∑': 'pu', '„Å∫': 'pe', '„ÅΩ': 'po',
            // Katakana de base
            '„Ç¢': 'a', '„Ç§': 'i', '„Ç¶': 'u', '„Ç®': 'e', '„Ç™': 'o',
            '„Ç´': 'ka', '„Ç≠': 'ki', '„ÇØ': 'ku', '„Ç±': 'ke', '„Ç≥': 'ko',
            // Dakuten Katakana
            '„Ç¨': 'ga', '„ÇÆ': 'gi', '„Ç∞': 'gu', '„Ç≤': 'ge', '„Ç¥': 'go',
            // Handakuten Katakana
            '„Éë': 'pa', '„Éî': 'pi', '„Éó': 'pu', '„Éö': 'pe', '„Éù': 'po',
            // Kanji N5 avec traduction et emoji
            '‰∏Ä': 'ichi üî¢ (un)', '‰∏É': 'nana üî¢ (sept)', '‰∏á': 'man üî¢ (dix mille)', 
            '‰∏â': 'san üî¢ (trois)', '‰∏ä': 'ue ‚¨ÜÔ∏è (haut)', '‰∏ã': 'shita ‚¨áÔ∏è (bas)', 
            '‰∏≠': 'naka ‚öñÔ∏è (milieu)', '‰πù': 'kyuu üî¢ (neuf)', '‰∫å': 'ni üî¢ (deux)', 
            '‰∫î': 'go üî¢ (cinq)', '‰∫∫': 'hito üë§ (personne)', '‰ªä': 'ima ‚è≥ (maintenant)', 
            '‰ºë': 'yasumi üò¥ (repos)', '‰Ωï': 'nani ‚ùì (quoi)', 'ÂÖà': 'saki ‚¨ÜÔ∏è (devant)', 
            'ÂÖ•': 'iri üö™ (entrer)', 'ÂÖ´': 'hachi üî¢ (huit)', 'ÂÖ≠': 'roku üî¢ (six)', 
            'ÂÜÜ': 'en üí¥ (yen)', 'Âá∫': 'de üö™ (sortir)', 'ÂàÜ': 'fun ‚è±Ô∏è (minute)', 
            'Ââç': 'mae ‚¨ÖÔ∏è (avant)', 'Âåó': 'kita üåè (nord)', 'ÂçÅ': 'juu üî¢ (dix)', 
            'ÂçÉ': 'sen üî¢ (mille)', 'Âçà': 'go ‚è∞ (midi)', 'Âçä': 'han ‚ûó (moiti√©)', 
            'Âçó': 'minami üåè (sud)', 'Âèã': 'tomo ü§ù (ami)', 'Âè≥': 'migi ‚û°Ô∏è (droite)', 
            'Âêç': 'na üìõ (nom)', 'Âõõ': 'shi üî¢ (quatre)', 'ÂõΩ': 'kuni üó∫Ô∏è (pays)', 
            'Âúü': 'tsuchi üåç (terre)', 'Â§ñ': 'soto üö™ (ext√©rieur)', 'Â§ß': 'dai üìè (grand)', 
            'Â§©': 'ten ‚òÅÔ∏è (ciel)', 'Â•≥': 'onna üë© (femme)', 'Â≠ê': 'ko üë∂ (enfant)', 
            'Â≠¶': 'gaku üìö (√©tudes)', 'Â∞è': 'shou üìê (petit)', 'Â±±': 'yama üèûÔ∏è (montagne)', 
            'Â∑ù': 'kawa üåä (rivi√®re)', 'Â∑¶': 'hidari ‚¨ÖÔ∏è (gauche)', 'Âπ¥': 'nen üìÖ (ann√©e)', 
            'Âæå': 'ato ‚û°Ô∏è (apr√®s)', 'Êó•': 'hi ‚òÄÔ∏è (jour)', 'ÊôÇ': 'ji ‚è∞ (heure)', 
            'Êõ∏': 'sho ‚úçÔ∏è (√©crire)', 'Êúà': 'getsu üåô (mois)', 'Êú®': 'ki üå≥ (arbre)', 
            'Êú¨': 'hon üìñ (livre)', 'Êù•': 'rai üö∂‚Äç‚û°Ô∏è (venir)', 'Êù±': 'higashi üåè (est)', 
            'Ê†°': 'kou üè´ (√©cole)', 'ÊØç': 'haha üë©‚Äçü¶≥ (m√®re)', 'ÊØé': 'mai üîÑ (chaque)', 
            'Ê∞ó': 'ki üí® (air)', 'Ê∞¥': 'mizu üíß (eau)', 'ÁÅ´': 'hi üî• (feu)', 
            'Áà∂': 'tou üë®‚Äçü¶≥ (p√®re)', 'Áîü': 'sei üå± (vie)', 'Áî∑': 'otoko üë® (homme)', 
            'ÁôΩ': 'shiro ‚ö™ (blanc)', 'Áôæ': 'hyaku üî¢ (cent)', 'ËÅû': 'kiku üëÇ (√©couter)', 
            'Ë°å': 'iku üö∂ (aller)', 'Ë•ø': 'nishi üåè (ouest)', 'Ë¶ã': 'mi üëÄ (voir)', 
            'Ë©±': 'hanashi üí¨ (parler)', 'Ë™û': 'go üó£Ô∏è (langue)', 'Ë™≠': 'yomu üìñ (lire)', 
            'Ëªä': 'kuruma üöó (voiture)', 'Èáë': 'kin üí∞ (or)', 'Èï∑': 'naga üìè (long)', 
            'Èñì': 'aida ‚è≥ (intervalle)', 'Èõ®': 'ame üåßÔ∏è (pluie)', 'Èõª': 'den ‚ö° (√©lectricit√©)', 
            'È£ü': 'ta üçΩÔ∏è (manger)', 'È´ò': 'taka ‚õ∞Ô∏è (haut)',
            // Kanji N4 avec traduction et emoji
            '‰∏ç': 'fu ‚ùå (non)', '‰∏ñ': 'yo üåç (monde)', '‰∏ª': 'nu üè† (ma√Ætre)', 
            '‰∫ã': 'koto üíº (affaire)', '‰∫¨': 'kyou üèØ (capitale)', '‰ª£': 'dai ‚è≥ (g√©n√©ration)', 
            '‰ª•': 'i ‚¨ÖÔ∏è (depuis)', '‰ºö': 'kai ü§ù (rencontre)', '‰Ωè': 'ju üè° (vivre)', 
            '‰Ωì': 'tai üí™ (corps)', '‰Ωú': 'saku ‚úçÔ∏è (faire)', '‰Ωø': 'shi üõ†Ô∏è (utiliser)', 
            'ÂÖÉ': 'gen üí∞ (origine)', 'ÂÖ¨': 'kou üèõÔ∏è (public)', 'Âàá': 'kiri ‚úÇÔ∏è (couper)', 
            'Âà•': 'betsu üîÄ (s√©parer)', 'Âäõ': 'riki üí™ (force)', 'Âãï': 'dou üö∂ (bouger)', 
            'Âè£': 'kuchi üëÑ (bouche)', 'Âè∞': 'dai üì∫ (plateforme)', 'Âêå': 'dou üë• (m√™me)', 
            'ÂìÅ': 'hin üì¶ (article)', 'Âì°': 'in üë• (membre)', 'Âïè': 'mon ‚ùì (question)', 
            'Âú∞': 'chi üåç (terre)', 'Â†¥': 'ba üèüÔ∏è (lieu)', 'Â£≤': 'bai üõí (vendre)', 
            'Â§ö': 'ta üî¢ (plusieurs)', 'Âßã': 'shi üèÅ (commencer)', 'ÂÆâ': 'an üí∏ (bon march√©)', 
            'ÂÆ∂': 'ie üè† (maison)', 'Â∞ë': 'shou üìê (peu)', 'Â∑•': 'kou üõ†Ô∏è (travail)', 
            'Â∫É': 'hiro üèûÔ∏è (large)', 'Â∫ó': 'ten üè¨ (magasin)', 'Â∫¶': 'do üìè (degr√©)', 
            'Âª∫': 'tate üèóÔ∏è (construire)', 'Âº∑': 'tsuyo üí™ (fort)', 'ÂøÉ': 'kokoro üíñ (c≈ìur)', 
            'ÊÄù': 'omo üí≠ (penser)', 'ÊÄ•': 'kyuu ‚è© (rapide)', 'ÊÑè': 'i üí° (intention)', 
            'Êâã': 'te ‚úã (main)', 'ÊåÅ': 'mo üõ†Ô∏è (tenir)', 'Êïô': 'kyou üìö (enseigner)', 
            'Êñá': 'bun üìú (culture)', 'Êñô': 'ryou üç≤ (frais)', 'Êñ∞': 'shin üåü (nouveau)', 
            'Êñπ': 'hou ‚û°Ô∏è (direction)', 'Êòé': 'mei ‚òÄÔ∏è (clair)', 'Êúâ': 'yu ‚úÖ (avoir)', 
            'Êúù': 'asa üåû (matin)', 'Ê•≠': 'gyou üíº (travail)', 'Ê•Ω': 'raku üéµ (plaisir)', 
            'Ê≠¢': 'tome ‚õî (arr√™ter)', 'Ê≠£': 'sei ‚úÖ (correct)', 'Ê≠ª': 'shi üíÄ (mort)', 
            'Êµ∑': 'umi üåä (mer)', 'ÁÑ°': 'mu ‚ùå (rien)', 'Áâ©': 'mono üéÅ (chose)', 
            'Áâπ': 'toku ‚≠ê (sp√©cial)', 'ÁêÜ': 'ri ‚öñÔ∏è (raison)', 'Áî®': 'you üõ†Ô∏è (usage)', 
            'Áî∞': 'ta üåæ (champ)', 'Áî∫': 'machi üèôÔ∏è (ville)', 'Áîª': 'ga üé® (peinture)', 
            'Áïå': 'kai üåç (monde)', 'ÁóÖ': 'byou ü§í (maladie)', 'Áô∫': 'hatsu üöÄ (lancer)', 
            'ÁõÆ': 'me üëÄ (≈ìil)', 'Áúü': 'shin ‚úÖ (vrai)', 'ÁùÄ': 'cha üëï (porter)', 
            'Áü•': 'chi üß† (savoir)', 'Á†î': 'ken üîç (recherche)', 'Á§æ': 'sha üè¢ (soci√©t√©)', 
            'ÁßÅ': 'watashi üë§ (moi)', 'Á©∂': 'kyuu üîç (recherche)', 'Á©∫': 'sora ‚òÅÔ∏è (ciel)', 
            'Á´ã': 'tatsu üèûÔ∏è (debout)', 'ÁµÇ': 'owari üèÅ (fin)', 'ËÄÉ': 'kangae üí≠ (penser)', 
            'ËÄÖ': 'sha üë§ (personne)', 'Ëá™': 'ji üöó (soi)', 'Ë®Ä': 'gen üí¨ (parole)', 
            'Ë®à': 'kei üìè (mesure)', 'Ë≥™': 'shitsu ‚öñÔ∏è (qualit√©)', 'Ëµ∑': 'oki üåÖ (se lever)', 
            'Ë∂≥': 'ashi üë£ (pied)', 'Ëª¢': 'ten üîÑ (tourner)', 'Ëøë': 'chika üìç (proche)', 
            'ÈÄÅ': 'sou üì¶ (envoyer)', 'ÈÄö': 'tsu üìû (passer)', 'ÈÅã': 'un üöö (transporter)', 
            'ÈÅì': 'michi üõ§Ô∏è (chemin)', 'Èáç': 'juu ‚öñÔ∏è (lourd)', 'Èáé': 'no üåæ (champ)', 
            'Èñã': 'kai üèÅ (ouvrir)', 'Èô¢': 'in üè• (institut)', 'ÈõÜ': 'shu üë• (rassembler)', 
            'È°å': 'dai ‚ùì (sujet)'
        };

        // Variables globales
        let selectedKana = [], selectedRomaji = [], currentKana, score = 0, mistakes = 0;
        let highScores = JSON.parse(localStorage.getItem('highScores')) || [];
        let hardcoreMode = false;
        let timerInterval;

        const startScreen = document.getElementById('start-screen');
        const gameScreen = document.getElementById('game-screen');
        const gameOverScreen = document.getElementById('game-over-screen');
        const hiraganaCheck = document.getElementById('hiragana-check');
        const katakanaCheck = document.getElementById('katakana-check');
        const kanjiN5Check = document.getElementById('kanji-n5-check');
        const kanjiN4Check = document.getElementById('kanji-n4-check');
        const hardcoreCheck = document.getElementById('hardcore-check');
        const startBtn = document.getElementById('start-btn');
        const kanaDisplay = document.getElementById('kana-display');
        const choicesDiv = document.getElementById('choices');
        const scoreSpan = document.getElementById('score');
        const highScoreSpan = document.getElementById('high-score');
        const recordDateSpan = document.getElementById('record-date');
        const livesDiv = document.getElementById('lives');
        const recordOverlay = document.getElementById('record-overlay');
        const highScoresDiv = document.getElementById('high-scores');
        const playAgainBtn = document.getElementById('play-again');
        const timerDiv = document.getElementById('timer');

        const maxLives = 3;
        const liveEmoji = '‚ù§Ô∏è';
        const lostEmoji = 'üíî';

        // Sons
        const correctSound = new Audio('https://www.myinstants.com/media/sounds/wow-anime-voice-accent.mp3');
        const wrongSound = new Audio('https://media.memesoundeffects.com/2022/11/Steve-Harvey-Nani.mp3');
        const gameOverSound = new Audio('https://www.myinstants.com/media/sounds/12322.mp3');
        const startScreenMusic = new Audio('https://www.myinstants.com/media/sounds/japanese-tv-meme-compilation.mp3');
        startScreenMusic.loop = true;

        // Initialisation des scores
        const topScore = highScores.length > 0 ? Math.max(...highScores.map(s => s.score)) : 0;
        highScoreSpan.textContent = topScore;
        recordDateSpan.textContent = highScores.length > 0 ? highScores.find(s => s.score === topScore).date : '-';
        updateLives();

        // Fonctions utilitaires
        function getRandomKana() {
            return selectedKana[Math.floor(Math.random() * selectedKana.length)];
        }

        function getRandomRomaji(exclude) {
            let romaji;
            do {
                romaji = selectedRomaji[Math.floor(Math.random() * selectedRomaji.length)];
            } while (romaji === exclude);
            return romaji;
        }

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function updateLives() {
            livesDiv.textContent = liveEmoji.repeat(maxLives - mistakes) + lostEmoji.repeat(mistakes);
        }

        function launchConfetti() {
            confetti({
                particleCount: 100,
                spread: 70,
                origin: { y: 0.6 }
            });
        }

        function updateHighScores() {
            highScores.push({ score, date: new Date().toLocaleString() });
            highScores.sort((a, b) => b.score - a.score);
            highScores = highScores.slice(0, 5);
            localStorage.setItem('highScores', JSON.stringify(highScores));
            const topScore = highScores[0].score;
            highScoreSpan.textContent = topScore;
            recordDateSpan.textContent = highScores[0].date;
            return score > topScore;
        }

        function startTimer() {
            let timeLeft = 5;
            timerDiv.style.display = 'block';
            timerDiv.textContent = `TIME LEFT: ${timeLeft}s`;
            timerInterval = setInterval(() => {
                timeLeft--;
                timerDiv.textContent = `TIME LEFT: ${timeLeft}s`;
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    wrongSound.play();
                    mistakes++;
                    updateLives();
                    if (mistakes >= maxLives) {
                        gameOver();
                    } else {
                        nextKana();
                    }
                }
            }, 1000);
        }

        // Fonctions de jeu
        function initializeChoices() {
            selectedKana = [];
            selectedRomaji = [];
            if (hiraganaCheck.checked) {
                selectedKana.push(...hiraganaList);
                selectedRomaji.push(...hiraganaList.map(k => kanaToRomaji[k]));
            }
            if (katakanaCheck.checked) {
                selectedKana.push(...katakanaList);
                selectedRomaji.push(...katakanaList.map(k => kanaToRomaji[k]));
            }
            if (kanjiN5Check.checked) {
                selectedKana.push(...kanjiN5List);
                selectedRomaji.push(...kanjiN5List.map(k => kanaToRomaji[k].split(' ')[0]));
            }
            if (kanjiN4Check.checked) {
                selectedKana.push(...kanjiN4List);
                selectedRomaji.push(...kanjiN4List.map(k => kanaToRomaji[k].split(' ')[0]));
            }
            hardcoreMode = hardcoreCheck.checked;
        }

        function nextKana() {
            if (hardcoreMode) {
                clearInterval(timerInterval);
                startTimer();
            } else {
                timerDiv.style.display = 'none';
            }
            currentKana = getRandomKana();
            kanaDisplay.textContent = currentKana;
            const correctAnswer = kanaToRomaji[currentKana].split(' ')[0];
            
            let choices = [correctAnswer];
            while (choices.length < 4) {
                let randomChoice = getRandomRomaji(correctAnswer);
                if (!choices.includes(randomChoice)) choices.push(randomChoice);
            }
            choices = shuffle(choices);
            
            choicesDiv.innerHTML = '';
            choices.forEach(choice => {
                const btn = document.createElement('button');
                const isKanji = kanjiN5List.includes(currentKana) || kanjiN4List.includes(currentKana);
                if (isKanji) {
                    const kanjiForChoice = Object.entries(kanaToRomaji).find(([k, v]) => v.startsWith(choice));
                    if (kanjiForChoice) {
                        const parts = kanaToRomaji[kanjiForChoice[0]].split(' ');
                        const emoji = parts[1];
                        const translation = parts[2] ? `${parts[2].replace('<small>', '').replace('</small>', '')}` : '';
                        btn.innerHTML = `${choice} ${emoji}<br>${translation}`;
                    } else {
                        btn.textContent = choice;
                    }
                } else {
                    btn.textContent = choice;
                }
                btn.onclick = () => checkAnswer(choice);
                choicesDiv.appendChild(btn);
            });
        }

        function checkAnswer(selected) {
            if (hardcoreMode) clearInterval(timerInterval);
            const correct = selected === kanaToRomaji[currentKana].split(' ')[0];
            
            if (correct) {
                correctSound.play();
                launchConfetti();
                score++;
                scoreSpan.textContent = score;
                if (updateHighScores()) {
                    recordOverlay.classList.remove('hidden');
                    setTimeout(() => recordOverlay.classList.add('hidden'), 3000);
                }
            } else {
                wrongSound.play();
                mistakes++;
                updateLives();
                if (mistakes >= maxLives) {
                    gameOver();
                    return;
                }
            }
            setTimeout(nextKana, 500);
        }

        function gameOver() {
            gameOverSound.play();
            gameScreen.classList.add('hidden');
            gameOverScreen.classList.remove('hidden');
            highScoresDiv.innerHTML = highScores.map((s, i) => 
                `<p>${i + 1}. ${s.score} (${s.date})</p>`
            ).join('');
        }

        // √âcouteurs d'√©v√©nements
        startBtn.onclick = () => {
            if (!hiraganaCheck.checked && !katakanaCheck.checked && !kanjiN5Check.checked && !kanjiN4Check.checked) {
                alert('Â∞ë„Å™„Åè„Å®„ÇÇ1„Å§ÈÅ∏„Çì„Åß„Å≠ÔºÅ');
                return;
            }
            startScreenMusic.pause();
            initializeChoices();
            startScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');
            nextKana();
        };

        playAgainBtn.onclick = () => {
            score = 0;
            mistakes = 0;
            scoreSpan.textContent = '0';
            updateLives();
            gameOverScreen.classList.add('hidden');
            startScreen.classList.remove('hidden');
            startScreenMusic.play();
        };

        // Jouer la musique de l'√©cran de d√©marrage au chargement
        window.onload = () => startScreenMusic.play();
    </script>
</body>
</html>